cmake_minimum_required(VERSION 3.26)
project(app)


find_package(SDL3 REQUIRED)

include(FetchContent)

FetchContent_Declare(
    glad
    GIT_REPOSITORY https://github.com/Dav1dde/glad
    GIT_TAG        v2.0.6
    GIT_SHALLOW    TRUE
    GIT_PROGRESS   TRUE
)

FetchContent_GetProperties(glad)
if(NOT glad_POPULATED)
    message("Fetching glad")
    FetchContent_MakeAvailable(glad)

    add_subdirectory("${glad_SOURCE_DIR}/cmake" glad_cmake)
    glad_add_library(glad 
        REPRODUCIBLE 
        EXCLUDE_FROM_ALL 
        LOADER 
        API gl:core=3.3 
        EXTENSIONS 
            GL_ARB_bindless_texture 
            GL_EXT_texture_compression_s3tc
    )
endif()

add_executable(main)

target_sources(main
PRIVATE
    main.cpp
)

target_link_libraries(main 
    PRIVATE 
        SDL3::SDL3
        opengl32
        glad
)

if(MINGW)
	# This removes the need for libgcc_s_seh-1.dll and libstdc++-6.dll
	target_link_options(main PRIVATE -static-libgcc -static-libstdc++ -static)
    add_custom_command(
        TARGET main POST_BUILD
        COMMAND "${CMAKE_COMMAND}" -E copy $<TARGET_FILE:SDL3::SDL3-shared> $<TARGET_FILE_DIR:main>
        VERBATIM
    )
endif()

# Copy Vertex Shader
# configure_file(
#     "${CMAKE_CURRENT_SOURCE_DIR}/vertex_shader.glsl"
#     "${CMAKE_CURRENT_BINARY_DIR}/vertex_shader.glsl"
#     COPYONLY
# )

# Copy Fragment Shader
# configure_file(
#     "${CMAKE_CURRENT_SOURCE_DIR}/frag_shader.glsl"
#     "${CMAKE_CURRENT_BINARY_DIR}/frag_shader.glsl"
#    COPYONLY
#)

install(TARGETS main DESTINATION .)
install(FILES 
    #"${CMAKE_CURRENT_BINARY_DIR}/vertex_shader.glsl" 
    #"${CMAKE_CURRENT_BINARY_DIR}/frag_shader.glsl" 
    "${CMAKE_CURRENT_BINARY_DIR}/SDL3.dll"
    DESTINATION .
)